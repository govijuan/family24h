function displayModal(e){"use strict";if($("#myModal .modal-body .col-xs-3").show(),button.hasClass("btn-danger")&&(button.removeClass("btn-danger"),button.addClass("btn-success")),"lock"===e){title[0].innerHTML=tr("Mark as stolen"),avatar[0].src="/images/ic_phonelink_lock_black_48px.svg";var t=tr("You are about to mark this device as stolen")+".<br />";t+=tr("This inplies in")+":<br /><br /><ul>",t+="<li>"+tr("You must create a new unlock code for the device")+"</li>",t+="<li>"+tr("For each unlock attempt a picture of the front camera will be taken")+"</li>",t+="<li>"+tr("Each unlock attempt will send the device location")+"</li>",t+="<li>"+tr("This functionality will be deactivated only when is unlocked by entering the new unlock code")+"</li>",t+="</ul>",description[0].innerHTML=t,button[0].innerHTML=tr("Continue"),button[0].setAttribute("onclick","confirmModal('lock');")}"ring"===e&&(title[0].innerHTML=tr("Ring your phone"),avatar[0].src="/images/ic_speaker_phone_black_48px.svg",description[0].innerHTML=tr("You can ring your phone"),button[0].innerHTML=tr("Ring"),button[0].setAttribute("onclick","notification('ring');")),"wipe"===e&&(title[0].innerHTML=tr("Wipe your phone"),avatar[0].src="/images/ic_phonelink_erase_black_48px.svg",description[0].innerHTML="<strong>"+tr("Attention")+":</strong><br />"+tr("You can wipe your phone"),button[0].innerHTML=tr("Continue"),button[0].setAttribute("onclick","confirmModal('wipe');"),button.removeClass("btn-success"),button.addClass("btn-danger")),resetMessage($("#flash-modal")),modal.modal()}function confirmModal(e){"use strict";$("#myModal .modal-body .col-xs-3").hide(),"lock"===e&&(title[0].innerHTML=tr("Insert a new unlock code"),description.empty(),description.append("<div class='row'><div class='col-sm-7 fields'></div><div class='col-sm-5 obs'></div></div>"),$(description).find(".fields").append(tr("App Login Password")+":<br /><input type='password' name='confirm[password]' id='confirm[password]'/><br /><br />"),$(description).find(".fields").append(tr("New Unlock Password")+":<br /><input type='password' name='new[password]' id='new[password]'/><br />"),$(description).find(".fields").append(tr("Confirm Unlock Password")+":<br /><input type='password' name='new_conf[password]' id='new_conf[password]'/><br />"),$(description).find(".obs").append("<div class='hidden-xs'><br /><br /><br /><br /><br /></div>"),$(description).find(".obs").append("<small>- "+tr("Password must be between 5 and 10 digits")+"<br /></small>"),$(description).find(".obs").append("<small>- "+tr("Password can be letters or numbers")+"<br /></small>"),button[0].innerHTML=tr("Lock"),button[0].setAttribute("onclick","notification('lock');")),"wipe"===e&&(title[0].innerHTML=tr("Confirm your password"),description.empty(),description.append(tr("App Login Password")+":<br /><input type='password' name='confirm[password]' id='confirm[password]'/><br />"),button[0].innerHTML=tr("Wipe"),button[0].setAttribute("onclick","notification('wipe');"),button.removeClass("btn-success"),button.addClass("btn-danger")),modal.modal()}function notification(e){"use strict";if("lock"==e||"wipe"==e){var t=document.getElementsByName("confirm[password]");if("lock"==e){var o=document.getElementsByName("new[password]"),n=document.getElementsByName("new_conf[password]");if(o[0].value!=n[0].value)return setMessage(tr("Invalid password confirmation"),"danger",$("#flash-modal")),!1;if($(o).val().length<5||$(o).val().length>10)return setMessage(tr("Password must be between 5 and 10 digits"),"danger",$("#flash-modal")),!1}if(""==t[0].value)return setMessage(tr("Invalid Login App Password"),"danger",$("#flash-modal")),!1;var a="/users/"+user_id,s="&password="+t[0].value+"&current_password="+t[0].value;$.ajax({url:api_url+a,type:"PUT",data:s+"&api_key="+api_key,crossDomain:!0,complete:function(t,o,n){(200===t.status||202===t.status)&&sendCommand(e)},error:function(e,t,o){console.log(e),setMessage(tr("Wrong password"),"danger",$("#flash-modal"))}})}else sendCommand(e)}function sendCommand(e){var t="/notification-messages";if("ring"!=e){if("lock"==e)var o=document.getElementsByName("new[password]");else var o=document.getElementsByName("confirm[password]");var n="&password="+o[0].value}else var n="";var a="&code=",s="&event_id=",i="&data={}",r=guid();"lock"==e&&(a+="device:locked"),"unlock"==e&&(a+="device:unlocked"),"ring"==e&&(a+="buzzer/turn-on"),"wipe"==e&&(a+="device:wipe"),s+=r;var d=a+i+s;("lock"==e||"wipe"==e)&&(d+=n),$.ajax({url:api_url+t,type:"POST",data:d+"&api_key="+api_key,crossDomain:!0,complete:function(t,o,n){if(200===t.status||202===t.status){var a="";"lock"==e&&(a+=tr("Device marked as stolen"),setMessage(a,"success")),"unlock"==e&&(a+=tr("Device unmarked as stolen"),setMessage(a,"success")),"ring"==e&&(a+=tr("Device ringing"),setMessage(a,"success")),"wipe"==e&&(a+=tr("Device's data wiped"),setMessage(a,"success"))}},error:function(e,t,o){console.log(e),setMessage(tr("Error sending command")+" ("+e.status+")","danger")}}),modal.modal("hide")}function setMessage(e,t,o){o||(o=flash),o.find(".message").empty(),o.find(".message").append(e),o.removeClass("alert-success alert-info alert-warning alert-danger"),o.addClass("alert-"+t),o.fadeIn("slow")}function resetMessage(e){e||(e=flash),e.find(".message").empty(),e.removeClass("alert-success alert-info alert-warning alert-danger"),e.hide()}function showPosition(e){"use strict";var t=data_location.latitude,o=data_location.longitude,n=new google.maps.LatLng(t,o),a={zoom:15,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP},s=document.getElementById("mapdiv");googleMap=new google.maps.Map(s,a);var i={map:googleMap,position:n,title:"Hi , I am here",animation:google.maps.Animation.DROP},r=new google.maps.Marker(i),d=new google.maps.Geocoder;d.geocode({latLng:n},function(e,t){if(t==google.maps.GeocoderStatus.OK)if(e[1]){var o={content:e[1].formatted_address,position:n},a=new google.maps.InfoWindow(o);google.maps.event.addListener(r,"click",function(){a.open(googleMap)})}else setMessage("No results found.","warning");else setMessage("Geocoder failed due to: "+t,"warning")});setTimeout(function(){google.maps.event.trigger(s,"resize")},2e3);google.maps.event.addDomListener(window,"resize",function(){centerMap()})}function centerMap(){if(data_location&&googleMap){var e=data_location.latitude,t=data_location.longitude,o=new google.maps.LatLng(e,t);googleMap.setCenter(o)}}function stopWatch(){"use strict";watchId&&(navigator.geolocation.clearWatch(watchId),watchId=null)}function resizeSidebar(){"use strict";var e=window.innerHeight,t=window.innerWidth,o=document.getElementsByClassName("button__bar"),n=document.getElementsByClassName("top"),a=document.getElementById("mapdiv");t>991?(o[0].style.height=e-n[0].offsetHeight+"px",a.style.height=e-n[0].offsetHeight+"px"):(o[0].style.height="auto",a.style.height=e-n[0].offsetHeight+"px"),centerMap()}function getTrack(){if(api_key){var e="/device-tracks";$.ajax({url:api_url+e,type:"GET",crossDomain:!0,data:"&api_key="+api_key,statusCode:{200:function(e){e.tracks&&e.tracks[0].location&&(data_location=e.tracks[0].location,showPosition())},400:function(e){api_key="",onerror&&onerror(e)},403:function(e){api_key="",onerror&&onerror(e)}}})}else onerror&&onerror()}var modal=$("#myModal"),title=$("#myModal .modal-title"),avatar=$("#myModal .modal-body .avatar img"),description=$("#myModal .modal-body p"),button=$("#myModal .modal-footer .btn"),googleMap,data_location,watchId=null;$(document).ready(function(){validateCookie(function(){for(var e=document.querySelectorAll(".telephone"),t=document.querySelectorAll(".name"),o=document.querySelectorAll(".email"),n=document.querySelectorAll(".profile_picture_url"),a=0;a<=e.length-1;a++)e[a].innerHTML=user_data.telephone,t[a].innerHTML=user_data.name,o[a].innerHTML=user_data.email,n[a].innerHTML=user_data.profile_picture_url;$(".dashboard-content").show(),$(".preloader").fadeOut("fast")},__default_cookie_error),$(".user-config").click(function(){$(".config-box").toggle()}),$("#flash .close,#flash-modal .close").click(function(){$(this).parent().fadeOut("slow")})}),$(document).ready(function(){$(".button__bar .buttons a p").each(function(e,t){$(t).html(tr($(t).html()))}),resizeSidebar()}),window.addEventListener?window.addEventListener("load",resizeSidebar,!1):window.attachEvent("onload",resizeSidebar),window.addEventListener("orientationchange",resizeSidebar,!1),window.addEventListener("resize",resizeSidebar,!1);var load_map=setTimeout(getTrack(),2e3);