function displayModal(e){"use strict";if($("#myModal .modal-body .col-xs-3").show(),button.hasClass("btn-danger")&&(button.removeClass("btn-danger"),button.addClass("btn-success")),"lock"===e){title[0].innerHTML=tr("Mark as stolen"),avatar[0].src="/images/ic_phonelink_lock_black_48px.svg";var t=tr("You are about to mark this device as stolen")+".<br />";t+=tr("This inplies in")+":<br /><br /><ul>",t+="<li>"+tr("You must create a new unlock code for the device")+"</li>",t+="<li>"+tr("For each unlock attempt a picture of the front camera will be taken")+"</li>",t+="<li>"+tr("Each unlock attempt will send the device location")+"</li>",t+="<li>"+tr("This functionality will be deactivated only when is unlocked by entering the new unlock code")+"</li>",t+="</ul>",description[0].innerHTML=t,button[0].innerHTML=tr("Continue"),button[0].setAttribute("onclick","confirmModal('lock');")}"ring"===e&&(title[0].innerHTML=tr("Ring your phone"),avatar[0].src="/images/ic_speaker_phone_black_48px.svg",description[0].innerHTML=tr("You can ring your phone"),button[0].innerHTML=tr("Ring"),button[0].setAttribute("onclick","notification('ring');")),"wipe"===e&&(title[0].innerHTML=tr("Wipe your phone"),avatar[0].src="/images/ic_phonelink_erase_black_48px.svg",description[0].innerHTML="<strong>"+tr("Attention")+":</strong><br />"+tr("You can wipe your phone"),button[0].innerHTML=tr("Continue"),button[0].setAttribute("onclick","confirmModal('wipe');"),button.removeClass("btn-success"),button.addClass("btn-danger")),resetMessage($("#flash-modal")),modal.modal()}function confirmModal(e){"use strict";$("#myModal .modal-body .col-xs-3").hide(),"lock"===e&&(title[0].innerHTML=tr("Insert a new unlock code"),description.empty(),description.append("<div class='row'><div class='col-sm-7 fields'></div><div class='col-sm-5 obs'></div></div>"),$(description).find(".fields").append(tr("App Login Password")+":<br /><input type='password' name='confirm[password]' id='confirm[password]'/><br /><br />"),$(description).find(".fields").append(tr("New Unlock Password")+":<br /><input type='password' name='new[password]' id='new[password]'/><br />"),$(description).find(".fields").append(tr("Confirm Unlock Password")+":<br /><input type='password' name='new_conf[password]' id='new_conf[password]'/><br />"),$(description).find(".obs").append("<div class='hidden-xs'><br /><br /><br /><br /><br /></div>"),$(description).find(".obs").append("<small>- "+tr("Password must be between 5 and 10 digits")+"<br /></small>"),$(description).find(".obs").append("<small>- "+tr("Password can be letters or numbers")+"<br /></small>"),button[0].innerHTML=tr("Lock"),button[0].setAttribute("onclick","notification('lock');")),"wipe"===e&&(title[0].innerHTML=tr("Confirm your password"),description.empty(),description.append(tr("App Login Password")+":<br /><input type='password' name='confirm[password]' id='confirm[password]'/><br />"),button[0].innerHTML=tr("Wipe"),button[0].setAttribute("onclick","notification('wipe');"),button.removeClass("btn-success"),button.addClass("btn-danger")),modal.modal()}function notification(e){"use strict";if("lock"==e||"wipe"==e){var t=document.getElementsByName("confirm[password]");if("lock"==e){var i=document.getElementsByName("new[password]"),a=document.getElementsByName("new_conf[password]");if(i[0].value!=a[0].value)return setMessage(tr("Invalid password confirmation"),"danger",$("#flash-modal")),!1;if($(i).val().length<5||$(i).val().length>10)return setMessage(tr("Password must be between 5 and 10 digits"),"danger",$("#flash-modal")),!1}if(""==t[0].value)return setMessage(tr("Invalid Login App Password"),"danger",$("#flash-modal")),!1;var s="/users/"+user_id,n="&password="+t[0].value+"&current_password="+t[0].value;$.ajax({url:api_url+s,type:"PUT",data:n+"&api_key="+api_key,crossDomain:!0,complete:function(t,i,a){200!==t.status&&202!==t.status||sendCommand(e)},error:function(e,t,i){console.log(e),setMessage(tr("Wrong password"),"danger",$("#flash-modal"))}})}else sendCommand(e)}function sendCommand(e){var t="/notification-messages";if("ring"!=e){if("lock"==e)var i=document.getElementsByName("new[password]");else var i=document.getElementsByName("confirm[password]");var a="&password="+i[0].value}else var a="";var s="&code=",n="&event_id=",o="&data={}",r=guid();"lock"==e&&(s+="device:locked"),"unlock"==e&&(s+="device:unlocked"),"ring"==e&&(s+="buzzer/turn-on"),"wipe"==e&&(s+="device:wipe"),n+=r;var l=s+o+n;"lock"!=e&&"wipe"!=e||(l+=a),$.ajax({url:api_url+t,type:"POST",data:l+"&api_key="+api_key,crossDomain:!0,complete:function(t,i,a){if(200===t.status||202===t.status){var s="";"lock"==e&&(s+=tr("Device marked as stolen"),setMessage(s,"success")),"unlock"==e&&(s+=tr("Device unmarked as stolen"),setMessage(s,"success")),"ring"==e&&(s+=tr("Device ringing"),setMessage(s,"success")),"wipe"==e&&(s+=tr("Device's data wiped"),setMessage(s,"success"))}},error:function(e,t,i){console.log(e),setMessage(tr("Error sending command")+" ("+e.status+")","danger")}}),modal.modal("hide")}function forcePosition(e){e||(e=user_id);var t="/users/"+e+"/real-time-positions";setMessage(tr("Sending request"),"warning"),$.ajax({url:api_url+t+"?api_key=$$key".render({key:api_key}),data:"&group_id="+group_id,type:"POST",crossDomain:!0,complete:function(e,t,i){if(200===e.status||202===e.status){var a="";a+=tr("Request successful sent"),setMessage(a,"success")}},error:function(e,t,i){setMessage(tr("Error sending request")+" ("+e.status+")","danger")}})}function setMessage(e,t,i){i||(i=flash),i.find(".message").empty(),i.find(".message").append(e),i.removeClass("alert-success alert-info alert-warning alert-danger"),i.addClass("alert-"+t),i.fadeIn("slow")}function resetMessage(e){e||(e=flash),e.find(".message").empty(),e.removeClass("alert-success alert-info alert-warning alert-danger"),e.hide()}function showPosition(e){"use strict";var t=data_location.latitude,i=data_location.longitude,a=new google.maps.LatLng(t,i),s={zoom:15,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP},n=document.getElementById("mapdiv");googleMap=new google.maps.Map(n,s);setTimeout(function(){google.maps.event.trigger(n,"resize")},2e3);google.maps.event.addDomListener(window,"resize",function(){centerMap()})}function centerMap(){if(data_location&&googleMap)if(markers.length>0){for(var e=new google.maps.LatLngBounds,t=0;t<markers.length;t++)e.extend(markers[t].getPosition());googleMap.fitBounds(e)}else{var i=data_location.latitude,a=data_location.longitude,s=new google.maps.LatLng(i,a);googleMap.setCenter(s)}}function stopWatch(){"use strict";watchId&&(navigator.geolocation.clearWatch(watchId),watchId=null)}function resizeSidebar(){"use strict";var e=window.innerHeight,t=window.innerWidth,i=$(".left__bar"),a=$(".left__bar .fixed-top"),s=$(".left__bar .fixed-bottom"),n=$(".top"),o=$(".bottom__bar"),r=$(".map");if($(".left__bar .list-members").length>0){var l=$(".left__bar .list-members"),d=$(".left__bar .list-members-top");$(l).animate({height:e-(n[0].offsetHeight+o[0].offsetHeight+d[0].offsetHeight+a[0].offsetHeight+s[0].offsetHeight)+"px"},"fast",function(){})}if($(".left__bar .list-fences").length>0){var c=$(".left__bar .list-fences"),p=$(".left__bar .list-fences-top"),u=$(".left__bar .list-fences-bottom");$(c).animate({height:e-(n[0].offsetHeight+o[0].offsetHeight+p[0].offsetHeight+u[0].offsetHeight+a[0].offsetHeight+s[0].offsetHeight)+"px"},"fast",function(){})}t>991?($(i).animate({height:e-(n[0].offsetHeight+o[0].offsetHeight)+"px"},"fast"),$(r).animate({height:e-(n[0].offsetHeight+o[0].offsetHeight)+"px"},"fast")):($(i).css("height","auto"),$(r).css("height",e-(n[0].offsetHeight+o[0].offsetHeight)+"px"))}function getTrack(){if(api_key){var e="/device-tracks";$.ajax({url:api_url+e,type:"GET",crossDomain:!0,data:"&api_key="+api_key,statusCode:{200:function(e){e.tracks&&e.tracks[0].location&&(data_location=e.tracks[0].location,showPosition())},400:function(e){api_key="",onerror&&onerror(e)},403:function(e){api_key="",onerror&&onerror(e)}}})}else onerror&&onerror()}function initialize(e,t){var i="/groups";$.ajax({type:"GET",dataType:"json",crossDomain:!0,url:api_url+i+"?api_key=$$key".render({key:api_key}),success:function(i,a,s){200==s.status&&(group_list=i.groups,$(".left__bar .fixed-top .contents").empty(),$(".left__bar .fixed-top .contents").append("<div class='group-select'><select id='group-list'></select></div>"),$(".left__bar .left-contents").empty(),$(".left__bar .left-contents").append("<div class='group-info'></div>"),$(".left__bar .fixed-bottom").remove(),$(".left__bar .group-info").after("<div class='fixed-bottom'></div>"),$.each(group_list,function(i,a){if(0==i&&void 0==$.getUrlVar("g")||$.getUrlVar("g")==a.id){$(".left__bar .group-info .info").length>0&&$(".left__bar .group-info .info").remove(),$(".left__bar .group-info").append("<div class='info' id=''></div>"),$(".left__bar .group-info .info").append("<div class='created-by item'><small>"+tr("Created by")+"</small><br />"+a.created_by.name+"</div>"),$(".left__bar .group-info .info").append("<div class='members item'><a href='#' id='loadMembersMenu'>"+tr("Group members")+"</a></div>"),$(".left__bar .group-info .info").append("<div class='members item'><a href='#' id='loadInvites'>"+tr("Manage invitations")+"</a></div>"),group_id=a.id;var s="/groups/"+group_id+"/members";$.ajax({type:"GET",dataType:"json",crossDomain:!0,url:api_url+s+"?api_key=$$key".render({key:api_key}),success:function(i,s,n){200==n.status&&(member_list=i.members,void 0!=$.getUrlVar("u")&&$.each(member_list,function(e,t){$.getUrlVar("u")==t.user_id&&(group_id=a.id,$("#group-list").val(group_id))}),e(t))},error:function(e){}})}var n="";$.getUrlVar("g")==a.id&&(n=" selected"),$("#group-list").append("<option value='"+a.id+"' "+n+">"+a.data.name)}),$("#group-list").change(function(){group_id=$("#group-list").find(":selected").val(),location.hash="#!/group?g="+$("#group-list").find(":selected").val()}),$("#loadMembersMenu").unbind(),$("#loadMembersMenu").bind("click",function(e){e.preventDefault(),loadMembersMenu()}),$("#loadInvites").unbind(),$("#loadInvites").bind("click",function(e){e.preventDefault(),loadInvites()}))},error:function(e){}})}function loadInvites(){$("#myModalInvites .invites .item").not(":first").remove(),$("#myModalInvites .invites .item").addClass("active"),$("#myModalInvites .invites .item button").each(function(e,t){$(this).html(tr($(this).html()))});var e="/users/group-suggestions";$("#myModalInvites .modal-header h4.modal-title").text(tr("Invites")),$.ajax({type:"GET",dataType:"json",crossDomain:!0,url:api_url+e+"?api_key=$$key".render({key:api_key}),success:function(e,t,i){invites_list=e.suggestions,invites_list.length>0?($(invites_list).each(function(e,t){if(e>0){var i=$($("#myModalInvites .invites .item")[0]).clone();$(i).removeClass("active"),$("#myModalInvites .invites").append(i)}var i=$("#myModalInvites .invites .item:last-child");$(i).attr("code",t.code),$(i).find(".invite-count").html(tr("Invite")+" "+(e+1)+tr(" of ")+invites_list.length),$(i).find(".group-info .caption-name").html(tr("Group Name")),$(i).find(".group-info .name").html(t.group.name),$(i).find(".group-info .caption-date").html(tr("Sent at")),$(i).find(".group-info .date").html(convertDate(t.invited_at)),$(i).find(".caption-member").html(tr("Invited by")),$(i).find(".member-info .name").html(t.group.name)}),$("#myModalInvites .invites .item").length>1?($("#myModalInvites .modal-footer button").html(tr("Next")),$("#myModalInvites .modal-footer button").attr("onclick","nextInvite();")):($("#myModalInvites .modal-footer button").html(tr("Back")),$("#myModalInvites .modal-footer button").attr("onclick","closeInvites();")),$("#myModalInvites .invites .item .btn.accept-invite").on("click",function(e){acceptInvite(!0)}),$("#myModalInvites .invites .item .btn.deny-invite").on("click",function(e){acceptInvite(!1)})):($("#myModalInvites .invites .item").hide(),$("#myModalInvites .no-invites").html(tr("No invites found")),$("#myModalInvites .no-invites").show(),$("#myModalInvites .modal-footer button").html(tr("Back")),$("#myModalInvites .modal-footer button").attr("onclick","closeInvites();")),$("#myModalInvites").modal()},error:function(e){$("#myModalInvites .invites .item").hide(),$("#myModalInvites .no-invites").html(tr("Error loading invites")),$("#myModalInvites").modal(),$("#myModalInvites .modal-footer button").html(tr("Back")),$("#myModalInvites .modal-footer button").attr("onclick","closeInvites();")}})}function nextInvite(){var e=$("#myModalInvites .invites .item").length,t=0;for(i=0;i<e;i++)$($("#myModalInvites .invites .item")[i]).hasClass("active")&&(t=i+1<e?i+1:0);$("#myModalInvites .invites .item").removeClass("active"),$($("#myModalInvites .invites .item")[t]).addClass("active")}function closeInvites(){$("#myModalInvites").modal("hide")}function acceptInvite(e){if(e)var t="POST";else var t="DELETE";var i="/groups/invites/accept/";$.ajax({type:t,dataType:"json",crossDomain:!0,url:api_url+i+"?api_key=$$key&code=$$code".render({key:api_key,code:$("#myModalInvites .invites .item.active").attr("code")}),success:function(t,i,a){e?msg=tr("Invite accepted"):msg=tr("Invite denied"),setMessage(msg,"success",$("#myModalInvites .flash-modal")),$("#myModalInvites .invites .item.active button").prop("disabled",!0)},error:function(e){msg=tr("Error sending command"),setMessage(msg,"danger",$("#myModalInvites .flash-modal"))}})}function loadGroupMembers(e){var t="/groups/"+group_id+"/members";$.ajax({type:"GET",dataType:"json",crossDomain:!0,url:api_url+t+"?api_key=$$key".render({key:api_key}),success:function(e,t,i){200==i.status&&(member_list=e.members,loadGroupPositions(loadGroupMarkers))},error:function(e){}})}function loadMembersMenu(){$(".left__bar .group-info").hide(),$(".left__bar .group-select").hide(),$(".left__bar .list-members-top").remove(),$(".left__bar .list-members").remove(),$(".left__bar .fixed-top .contents").append("<div class='list-members-top'></div>"),$(".left__bar .left-contents").append("<div class='list-members'><ul></ul></div>"),$(".left__bar .list-members-top").append('<a href="#"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span> Voltar</a>'),$(member_list).each(function(e,t){$(".left__bar .list-members ul").append("<li>"+t.name+"<a href='#' ref='"+t.user_id+"' class='context'><span class='glyphicon glyphicon-option-vertical' aria-hidden='true'></span></a></li>")}),resizeSidebar(),$(".left__bar .list-members ul li a.context").unbind(),$(".left__bar .list-members ul li a.context").bind("click",function(e){e.preventDefault(),$("#contextMenu ul li").remove(),$("#contextMenu ul").append("<li><a href='#!/member?u="+$(this).attr("ref")+"&g="+group_id+"' tabindex='-1' class='history'>"+tr("View position history")+"</a></li>"),$("#contextMenu ul").append("<li><a href='#' user-id='"+$(this).attr("ref")+"' tabindex='-1' class='force-position'>"+tr("Force position")+"</a></li>"),$("#contextMenu").show();var t=($(this).parent().offset(),$(this).parent()),i=$(".left__bar .list-members ul li").index($(t)),a=$(".left__bar .list-members").scrollTop(),s=$(".left__bar").width()-$("#contextMenu ul").width()-20;return $("#contextMenu").css({left:s,top:$(t).outerHeight()*(i+1)+$(".list-members-top").height()-a}),$("#contextMenu .dropdown-menu").fadeIn("fast"),$("#contextMenu ul li a.history").on("click",function(e){e.stopPropagation(),$("#contextMenu").hide(),checkIfMobile&&$(".left__bar .group-toggle").trigger("click")}),$("#contextMenu ul li a.force-position").on("click",function(e){e.preventDefault(),e.stopPropagation(),$("#contextMenu").hide(),forcePosition($(this).attr("user-id")),checkIfMobile&&$(".left__bar .group-toggle").trigger("click")}),!1}),$(".left__bar .list-members-top a").unbind(),$(".left__bar .list-members-top a").bind("click",function(e){return e.preventDefault(),closeMembersMenu(),!1}),$(".left__bar .fixed-bottom").remove(),$(".left__bar .list-members").after("<div class='fixed-bottom'></div>")}function closeMembersMenu(){$(".left__bar .list-members-top").remove(),$(".left__bar .list-members").remove(),$(".left__bar .group-info").show(),$(".left__bar .group-select").show()}function loadFencesMenu(){$(".left__bar .group-info").hide(),$(".left__bar .group-select").hide(),$(".left__bar .list-members-top").hide(),$(".left__bar .list-members").hide(),$(".left__bar .list-fences-top").remove(),$(".left__bar .list-fences-bottom").remove(),$(".left__bar .list-fences").remove(),$(".left__bar .fixed-top .contents").append("<div class='list-fences-top'></div>"),$(".left__bar .fixed-bottom").remove(),$(".left__bar .left-contents").append("<div class='list-fences'><ul></ul></div><div class='fixed-bottom'></div>"),$(".left__bar .fixed-bottom").append("<div class='list-fences-bottom'></div>"),$(".left__bar .list-fences-top").append('<a href="#"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span> Voltar</a>'),$(".left__bar .list-fences-bottom").append('<a href="#"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> '+tr("New Fence")+"</a>"),$(".left__bar .list-fences-bottom a").unbind(),$(".left__bar .list-fences-bottom a").bind("click",function(e){return e.preventDefault(),newFence(),checkIfMobile&&$(".left__bar .group-toggle").trigger("click"),!1}),$.each(member_list,function(e,t){t.user_id==parseInt($.getUrlVar("u"))&&(member_id=t.id)});var e="/virtual-fences?group_id="+group_id+"&member_id="+member_id;$.ajax({type:"GET",dataType:"json",crossDomain:!0,url:api_url+e+"&api_key=$$key".render({key:api_key}),success:function(e,t,i){200==i.status&&(fences_list=e.virtual_fences,$(fences_list).each(function(e,t){$(".left__bar .list-fences ul").append("<li>"+t.name+"<a href='#' ref='"+t.id+"' fence-type='"+t.type+"' class='context'><span class='glyphicon glyphicon-option-vertical' aria-hidden='true'></span></a></li>")}),$(".left__bar .list-fences ul li a.context").unbind(),$(".left__bar .list-fences ul li a.context").bind("click",function(e){e.preventDefault(),$("#contextMenu ul li").remove(),$("#contextMenu ul").append("<li><a href='#!/virtual-fences-delete?ref="+$(this).attr("ref")+"&g="+group_id+"&u="+$.getUrlVar("u")+"' tabindex='-1'>"+tr("Delete")+"</a></li>"),$("#contextMenu").show();var t=($(this).parent().offset(),$(this).parent()),i=$(".left__bar .list-fences ul li").index($(t)),a=$(".left__bar .list-fences").scrollTop(),s=$(".left__bar").width()-$("#contextMenu ul").width()-20;return $("#contextMenu").css({left:s,top:$(t).outerHeight()*(i+1)+$(".list-fences-top").height()-a}),$("#contextMenu .dropdown-menu").fadeIn("fast"),$("#contextMenu ul li a").on("click",function(e){e.stopPropagation(),$("#contextMenu").hide()}),!1}),$(".left__bar .list-fences-top a").unbind(),$(".left__bar .list-fences-top a").bind("click",function(e){return e.preventDefault(),closeFencesMenu(),!1}),$(".left__bar .list-fences ul li").unbind(),$(".left__bar .list-fences ul li").bind("click",function(e){$(".left__bar .list-fences ul li").removeClass("active"),$(this).addClass("active"),checkIfMobile&&$(".left__bar .group-toggle").trigger("click"),loadFence()}),checkIfMobile&&$(".left__bar .group-toggle").trigger("click"),loadFencesMarkers(),resizeSidebar())},error:function(e){setMessage(tr("Error loading virtual fences"),"danger",$("#flash-modal"))}})}function closeFencesMenu(){$(".left__bar .list-fences-top").remove(),$(".left__bar .list-fences").remove(),$(".left__bar .group-info").show(),$(".left__bar .group-select").show(),$(".left__bar .fixed-bottom").empty(),drawingManager&&(deleteShape(),drawingManager.setMap(null)),location.hash=""}function newFence(){drawingManager&&(deleteShape(),drawingManager.setMap(null)),$(".left__bar .list-fences ul li").removeClass("active"),$(".left__bar .list-fences ul").append("<li class='active'>"+tr("My New Fence")+"<a href='#' ref='' class='context hidden'><span class='glyphicon glyphicon-option-vertical' aria-hidden='true'></span></a></li>"),loadFence()}function saveFencePopup(){$("#myModal .modal-header h4.modal-title").text(tr("Save virtual fence")),$("#myModal .modal-body .col-sm-3").hide(),$("#myModal .modal-body p").empty(),$("#myModal .modal-body p").append("<div class='fields'></div>"),$("#myModal .modal-body p .fields").append(tr("Enter a name for your fence")+":<br /><input type='text' id='fence-name'/><br /><br />"),$("#myModal .modal-body p .fields").append(tr("Monitoring")+":<br /><select id='fence-type'></select><br /><br />"),$("#myModal .modal-body p .fields #fence-type").append("<option value='both'>"+tr("In and Out")+"</option>"),$("#myModal .modal-body p .fields #fence-type").append("<option value='in'>"+tr("In")+"</option>"),$("#myModal .modal-body p .fields #fence-type").append("<option value='out'>"+tr("Out")+"</option>"),$("#myModal .modal-footer button").html(tr("Save")),$("#myModal .modal-footer button").attr("onclick","saveFence();"),$(".left__bar .list-fences ul li.active").length>0&&($("#fence-name").val($(".left__bar .list-fences ul li.active").text()),$("#fence-type").val($(".left__bar .list-fences ul li.active a").attr("fence-type"))),$("#myModal").modal()}function saveFence(){$.each(member_list,function(e,t){t.user_id==parseInt($.getUrlVar("u"))&&(member_id=t.id)});var e=fencePolygon.getPath().getLength(),t=[];for(i=0;i<e;i++){var a=fencePolygon.getPath().getAt(i).toUrlValue(13).split(",");t.push({longitude:a[1],latitude:a[0]})}var s=$("#fence-name").val(),n=$("#fence-type option:selected").val();if(""==s)return setMessage(tr("Please enter a name"),"danger",$("#flash-modal")),!1;if($(".left__bar .list-fences ul li.active").length>0){if(""!=$(".left__bar .list-fences ul li.active a").attr("ref"))var o=$(".left__bar .list-fences ul li.active a").attr("ref"),r="PUT";else var o="",r="POST";var l="/virtual-fences/"+o;$.ajax({url:api_url+l+"?api_key=$$key".render({key:api_key}),data:"&group_id="+group_id+"&member_id="+member_id+"&name="+s+"&type="+n+"&points="+JSON.stringify(t),type:r,crossDomain:!0,complete:function(e,t,i){var a="";a+=tr("Fence successful saved"),setMessage(a,"success"),$("#myModal").modal("hide"),deleteShape(),$("#overmap .icons li.delete").hide(),$("#overmap .icons li.save").hide(),$("#overmap .icons li.edit").hide(),loadFencesMenu()},error:function(e,t,i){setMessage(tr("Error saving")+" ("+e.status+")","danger",$("#flash-modal"))}})}}function deleteFence(){$.each(member_list,function(e,t){t.user_id==parseInt($.getUrlVar("u"))&&(member_id=t.id)});var e="/virtual-fences/"+$.getUrlVar("ref");$.ajax({type:"DELETE",dataType:"json",crossDomain:!0,url:api_url+e+"?api_key=$$key".render({key:api_key}),data:"&group_id="+group_id+"&member_id="+member_id,success:function(e,t,i){msg=tr("Fence deleted successful"),setMessage(msg,"success"),location.hash="#!/virtual-fences?g="+$.getUrlVar("g")+"&u="+$.getUrlVar("u")},error:function(e){msg=tr("Error deleting"),setMessage(msg,"danger"),location.hash="#!/virtual-fences?g="+$.getUrlVar("g")+"&u="+$.getUrlVar("u")}})}function loadFence(){drawingManager&&(drawingManager.setMap(null),fencePolygon&&deleteShape(fencePolygon));var e={fillColor:"#a000aa",strokeWeight:0,fillOpacity:.45,editable:!0};if(drawingManager=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!1,drawingControlOptions:{drawingModes:[google.maps.drawing.OverlayType.POLYGON]},polylineOptions:{editable:!0},polygonOptions:e,map:googleMap}),google.maps.event.addListener(drawingManager,"overlaycomplete",function(e){e.type!=google.maps.drawing.OverlayType.MARKER&&(fencePolygon&&deleteShape(fencePolygon),drawingManager.setDrawingMode(null),fencePolygon=e.overlay,fencePolygon.type=e.type,clearSelection(),$("#overmap .icons li.edit").fadeOut("fast",function(){$("#overmap .icons li.delete").fadeIn(),$("#overmap .icons li.save").fadeIn()}))}),google.maps.event.addListener(googleMap,"click",clearSelection),$(".left__bar .list-fences ul li.active").length>0)if(""!=$(".left__bar .list-fences ul li.active a").attr("ref")){var t=parseInt($(".left__bar .list-fences ul li.active a").attr("ref")),i=[];if($(fences_list).each(function(e,a){t==a.id&&$(a.points).each(function(e,t){i.push(new google.maps.LatLng(t.latitude,t.longitude))})}),i.length>0){fencePolygon=new google.maps.Polygon({path:i,fillColor:"#a000aa",strokeWeight:0,fillOpacity:.45}),fencePolygon.setMap(googleMap);for(var a=new google.maps.LatLngBounds,s=0;s<i.length;s++)a.extend(i[s]);googleMap.fitBounds(a),clearSelection()}}else clearSelection(),$("#overmap .icons li.delete").hide(),$("#overmap .icons li.save").hide(),$("#overmap .icons li.edit").fadeIn();$("#overmap .icons li.delete").fadeIn(),$("#overmap .icons li.save").hide(),$("#overmap .icons li.delete a").on("click",function(e){$("#overmap .icons li.save").hide(),deleteShape(),$(this).parent().fadeOut("fast",function(){$("#overmap .icons li.edit").fadeIn()})}),$("#overmap .icons li.edit a").on("click",function(e){$("#overmap .icons li.save").hide(),setSelection(),$(this).parent().fadeOut()}),$("#overmap .icons li.save a").on("click",function(e){saveFencePopup()})}function clearSelection(){fencePolygon&&(fencePolygon.setEditable(!1),drawingManager.setDrawingMode(google.maps.drawing.OverlayType.POLYGON)),drawingManager.setDrawingMode(null)}function setSelection(){clearSelection(),fencePolygon&&fencePolygon.setEditable(!0),drawingManager.setDrawingMode(google.maps.drawing.OverlayType.POLYGON)}function deleteShape(){fencePolygon&&(fencePolygon.setMap(null),fencePolygon=null)}function loadGroupPositions(e){var t="/device-tracks/?group_id="+group_id;$.ajax({type:"GET",dataType:"json",crossDomain:!0,url:api_url+t+"&api_key=$$key".render({key:api_key}),success:function(t,i,a){200==a.status&&$.each(t.tracks,function(e,t){$.each(member_list,function(e,i){i.user_id==t.user_id&&(i.location=t.location,t.valid_time&&(i.valid_time=t.valid_time),t.network&&(i.network=t.network),t.other&&(i.other=t.other))})}),e()},error:function(e){}})}function loadMemberPositions(e){if(calendarSet){var t=$("#datepicker").datepicker("getDate");t=new Date(t).toString(),t=t.split(" 00:00:00 ");var i=new Date(t[0]+" "+$(".time-label .hour-ini").text()+":00 "+t[1]),a=new Date(t[0]+" "+$(".time-label .hour-end").text()+":00 "+t[1]),s=i;i=s.getUTCFullYear()+"-"+("0"+(s.getUTCMonth()+1)).slice(-2)+"-"+("0"+s.getUTCDate()).slice(-2)+"T"+("0"+s.getUTCHours()).slice(-2)+":"+("0"+s.getUTCMinutes()).slice(-2)+":00",s=a,a=s.getUTCFullYear()+"-"+("0"+(s.getUTCMonth()+1)).slice(-2)+"-"+("0"+s.getUTCDate()).slice(-2)+"T"+("0"+s.getUTCHours()).slice(-2)+":"+("0"+s.getUTCMinutes()).slice(-2)+":00";var n="/device-tracks?group_id="+group_id+"&user_id="+$.getUrlVar("u")+"&is_history=1&limit_rows=50";n+="&valid_time_after="+i,n+="&valid_time_before="+a}else var n="/device-tracks?group_id="+group_id+"&user_id="+$.getUrlVar("u")+"&is_history=1&limit_rows=10";$.ajax({type:"GET",dataType:"json",crossDomain:!0,url:api_url+n+"&api_key=$$key".render({key:api_key}),success:function(t,i,a){200==a.status&&(member_history=t.tracks),e()},error:function(e){}})}function generateAlias(e){var t=e.split(" "),a="";$.each(t,function(e,t){var i=t.charAt(0).toUpperCase();a+=i});var s="";for(i=0;i<10;i++)for(j=0;j<members_alias.length;j++)if(members_alias[j]==a+s){""==s&&(s=0),s+=1;break}var n=a;return""!=s&&(n=a+s),members_alias.push(n),n}function loadGroupMarkers(){members_alias=[],$(".bottom__bar .contents").remove(),$(".bottom__bar").append("<div class='contents'></div>"),$(".bottom__bar .contents").append("<ul class='user-list'></ul>"),$.each(member_list,function(e,t){t.alias||(t.alias=generateAlias(t.name));var i={lat:t.location.latitude,lng:t.location.longitude},a={map:googleMap,position:i,title:t.name,labelContent:t.alias,labelAnchor:new google.maps.Point(15,38),labelClass:"labels",labelInBackground:!1,icon:pinSymbol("#32ccfe"),animation:google.maps.Animation.DROP,user_id:t.user_id},s=new MarkerWithLabel(a);markers.push(s);var n="<div class='marker-info'>";t.profile_picture_url&&""!=t.profile_picture_url&&(n+="<div class='user-avatar'  style='background-image: url("+t.profile_picture_url+");'></div>"),n+="<div class='user-info'><p><a href='#!/member?u="+t.user_id+"&g="+group_id+"'>"+t.name+"</a></p>",n+="<p>"+t.location.human_address+"</p>",n+="<p>"+convertDate(t.valid_time)+"</p>",t.other&&t.other.battery&&(n+="<p class='battery'>Bateria: "+t.other.battery.level+"%</p>"),t.network&&t.network.network&&(n+="Wi-Fi"==t.network.network?"<p class='network'>Rede: "+t.network.network+"&nbsp;("+t.network.link_speed+")</p>":"3G"==t.network.network||"4G"==t.network.network?"<p class='network'>Rede: "+t.network.network+"&nbsp;("+t.network.signal+")</p>":"<p class='network'>Rede: offline</p>"),n+="</div></div>",s.addListener("click",function(){var e={content:n,position:i};popupIW&&popupIW.close(),popupIW=new google.maps.InfoWindow(e),popupIW.open(googleMap,s)});var o="";t.profile_picture_url&&""!=t.profile_picture_url&&(o+="<div class='user-avatar' style='background-image: url("+t.profile_picture_url+");'></div>"),o+="<div class='user-info'>",o+="<p class='name'><strong>"+t.name+"</strong>",o+=" <a hhref='#' class='force-position' user-id='"+t.user_id+"' title='"+tr("Force position")+"' alt='"+tr("Force position")+"'><span class='glyphicon glyphicon-repeat' aria-hidden='true'></span></a></p>",o+="<p class='address'>"+t.location.human_address+"</p>",o+="<p class='timestamp'>"+convertDate(t.valid_time)+"</p>",o+="</div>",$(".bottom__bar .contents .user-list").append("<li m-index='"+e+"'>"+o+"</li>")}),$(".user-list li a.force-position").on("click",function(e){e.preventDefault(),forcePosition($(this).attr("user-id"))}),$(".user-list li").unbind(),$(".user-list li").bind("click",function(e){google.maps.event.trigger(markers[$(this).attr("m-index")],"click"),$(".user-list li").removeClass("active"),$(this).addClass("active"),$("user-list li").addClass("hidden"),$("user-list li[m-index="+$(this).attr("m-index")+"]").removeClass("hidden");var t=markers[$(this).attr("m-index")].getPosition();googleMap.setCenter(t)}),markerClusterer&&markerClusterer.clearMarkers(),markerClusterer=new MarkerClusterer(googleMap,markers);for(var e=new google.maps.LatLngBounds,t=0;t<markers.length;t++)e.extend(markers[t].getPosition());googleMap.fitBounds(e),resizeSidebar()}function loadFencesMarkers(){$(".bottom__bar .contents").addClass("closed"),$.each(member_list,function(e,t){if(t.user_id==parseInt($.getUrlVar("u"))){t.alias||(t.alias=generateAlias(t.name));var i={lat:t.location.latitude,lng:t.location.longitude},a={map:googleMap,position:i,title:t.name,labelContent:t.alias,labelAnchor:new google.maps.Point(15,38),labelClass:"labels",labelInBackground:!1,icon:pinSymbol("#32ccfe"),animation:google.maps.Animation.DROP,user_id:t.user_id},s=new MarkerWithLabel(a);markers.push(s);var n="<div><p><a href='#!/member?u="+t.user_id+"&g="+group_id+"'>"+t.name+"</a></p>";n+="<p>"+t.location.human_address+"</p>",n+="<p>"+convertDate(t.valid_time)+"</p></div>",t.other&&t.other.battery&&(n+="<p class='battery'>Bateria: "+t.other.battery.level+"%</p>"),t.network&&t.network.network&&(n+="Wi-Fi"==t.network.network?"<p class='network'>Rede: "+t.network.network+"&nbsp;("+t.network.link_speed+")</p>":"3G"==t.network.network||"4G"==t.network.network?"<p class='network'>Rede: "+t.network.network+"&nbsp;("+t.network.signal+")</p>":"<p class='network'>Rede: offline</p>"),s.addListener("click",function(){var e={content:n,position:i};popupIW&&popupIW.close(),popupIW=new google.maps.InfoWindow(e),popupIW.open(googleMap,s)})}});for(var e=new google.maps.LatLngBounds,t=0;t<markers.length;t++)e.extend(markers[t].getPosition());googleMap.fitBounds(e),resizeSidebar()}function sort_by_date(e,t){return new Date(e.valid_time).getTime()-new Date(t.valid_time).getTime()}function loadMemberMarkers(){members_alias=[],$(".bottom__bar .contents").remove(),$(".bottom__bar").append("<div class='contents'></div>"),$(".bottom__bar .contents").append("<div class='user-history'><div class='info'></div><ul class='tabs'></ul><ul class='history'></ul></div>"),member_history.sort(sort_by_date),
member_history.length>5&&$(".bottom__bar .contents .user-history ul.tabs").append("<li m-index='prev' class='arrow disabled'><span class='glyphicon glyphicon-menu-left' aria-hidden='true'></span></li>"),$.each(member_history,function(e,t){var i={lat:t.location.latitude,lng:t.location.longitude},a={map:googleMap,position:i,title:convertDate(t.valid_time),labelContent:e+1,labelAnchor:new google.maps.Point(15,38),labelClass:"labels",labelInBackground:!1,icon:pinSymbol("#32ccfe"),animation:google.maps.Animation.DROP,_index:e},s=new MarkerWithLabel(a);markers.push(s);var n="<div><p>"+t.location.human_address+"</p>";n+="<p>"+convertDate(t.valid_time)+"</p></div>",t.other&&t.other.battery&&(n+="<p class='battery'>Bateria: "+t.other.battery.level+"%</p>"),t.network&&t.network.network&&(n+="Wi-Fi"==t.network.network?"<p class='network'>Rede: "+t.network.network+"&nbsp;("+t.network.link_speed+")</p>":"3G"==t.network.network||"4G"==t.network.network?"<p class='network'>Rede: "+t.network.network+"&nbsp;("+t.network.signal+")</p>":"<p class='network'>Rede: offline</p>"),s.addListener("click",function(){var e={content:n,position:i};popupIW&&popupIW.close(),popupIW=new google.maps.InfoWindow(e),popupIW.open(googleMap,s);var a=$(this)[0]._index;$(".user-history .tabs li.item").removeClass("active"),$(".user-history .tabs li[m-index="+a+"]").addClass("active"),$(".user-history .history li.item").addClass("hidden"),$(".user-history .history li[m-index="+a+"]").removeClass("hidden");var o="";t.user_picture&&""!=t.user_picture&&(o+="<div class='user-avatar' style='background-image: url("+t.user_picture+");'></div>"),o+="<div class='user-info'>",o+="<p class='name'>"+t.user_name+"</p>",o+="<p class='address'>"+t.location.human_address+"</p>",o+="<p class='timestamp'>"+convertDate(t.valid_time,"dd/MM/yyyy")+"</p>",o+="</div>",$(".user-history .info").html(o),mountTabs()});var o=convertDate(t.valid_time).split(" ");e>0?$(".bottom__bar .contents .user-history ul.tabs").append("<li m-index='"+e+"' class='item'>"+o[1]+"</li>"):$(".bottom__bar .contents .user-history ul.tabs").append("<li m-index='"+e+"' class='item active'>"+o[1]+"</li>");var r="";t.other&&t.other.battery&&(r+="<p class='battery'>Bateria: "+t.other.battery.level+"%</p>"),t.network&&t.network.network&&(r+="Wi-Fi"==t.network.network?"<p class='network'>Rede: "+t.network.network+"&nbsp;("+t.network.link_speed+")</p>":"3G"==t.network.network||"4G"==t.network.network?"<p class='network'>Rede: "+t.network.network+"&nbsp;("+t.network.signal+")</p>":"<p class='network'>Rede: offline</p>"),e>0?$(".bottom__bar .contents .user-history ul.history").append("<li class='item hidden' m-index='"+e+"'>"+r+"</li>"):$(".bottom__bar .contents .user-history ul.history").append("<li class='item' m-index='"+e+"'>"+r+"</li>")}),member_history.length>5&&$(".bottom__bar .contents .user-history ul.tabs").append("<li m-index='next' class='arrow'><span class='glyphicon glyphicon-menu-right' aria-hidden='true'></span></li>"),member_history.length<=0?$(".user-history").append("<div class='no-results text-center'>"+tr("This member has no history position")+".<br />"+tr("Use the calendar icon to choose a specific date")+".</div>"):$(".user-history .no-results").remove();var e=5;if(member_history.length>e)for($(".user-history .tabs li.item").hide(),i=0;i<e;i++)$(".user-history .tabs li[m-index="+i+"]").fadeIn();$(".user-history .tabs li").unbind(),$(".user-history .tabs li").bind("click",function(e){if($.scrollTo(".bottom__bar .contents",this),$(this).hasClass("arrow")){if($(this).hasClass("disabled"))return!0;var t=parseInt($(".user-history .tabs li.active").attr("m-index"));return"prev"==$(this).attr("m-index")?t--:"next"==$(this).attr("m-index")&&t++,t>=0&&t<member_history.length&&$(".user-history .tabs li[m-index="+t+"]").trigger("click"),0==t?($(".user-history .tabs li[m-index='prev']").addClass("disabled"),$(".user-history .tabs li[m-index='next']").removeClass("disabled")):t==member_history.length-1?($(".user-history .tabs li[m-index='next']").addClass("disabled"),$(".user-history .tabs li[m-index='prev']").removeClass("disabled")):($(".user-history .tabs li[m-index='prev']").removeClass("disabled"),$(".user-history .tabs li[m-index='next']").removeClass("disabled")),!0}var i=$(this).attr("m-index");mountTabs($(this).attr("m-index")),$(".user-history .tabs li.item").removeClass("active"),$(this).addClass("active"),$(".user-history .history li.item").addClass("hidden"),$(".user-history .history li[m-index="+$(this).attr("m-index")+"]").removeClass("hidden");var a=member_history[i],s={lat:a.location.latitude,lng:a.location.longitude},n="<div><p>"+a.location.human_address+"</p>";n+="<p>"+convertDate(a.valid_time)+"</p></div>",a.other&&a.other.battery&&(n+="<p class='battery'>Bateria: "+a.other.battery.level+"%</p>"),a.network&&a.network.network&&(n+="Wi-Fi"==a.network.network?"<p class='network'>Rede: "+a.network.network+"&nbsp;("+a.network.link_speed+")</p>":"3G"==a.network.network||"4G"==a.network.network?"<p class='network'>Rede: "+a.network.network+"&nbsp;("+a.network.signal+")</p>":"<p class='network'>Rede: offline</p>");var o="";a.user_picture&&""!=a.user_picture&&(o+="<div class='user-avatar' style='background-image: url("+a.user_picture+");'></div>"),o+="<div class='user-info'>",o+="<p class='name'>"+a.user_name+"</p>",o+="<p class='address'>"+a.location.human_address+"</p>",o+="<p class='timestamp'>"+convertDate(a.valid_time,"dd/MM/yyyy")+"</p>",o+="</div>",$(".user-history .info").html(o);var r={content:n,position:s};popupIW&&popupIW.close(),popupIW=new google.maps.InfoWindow(r),popupIW.open(googleMap,markers[i]),0==i?($(".user-history .tabs li[m-index='prev']").addClass("disabled"),$(".user-history .tabs li[m-index='next']").removeClass("disabled")):i==member_history.length-1?($(".user-history .tabs li[m-index='next']").addClass("disabled"),$(".user-history .tabs li[m-index='prev']").removeClass("disabled")):($(".user-history .tabs li[m-index='prev']").removeClass("disabled"),$(".user-history .tabs li[m-index='next']").removeClass("disabled"))}),google.maps.event.trigger(markers[0],"click"),markerClusterer&&markerClusterer.clearMarkers(),markerClusterer=new MarkerClusterer(googleMap,markers);for(var t=new google.maps.LatLngBounds,i=0;i<markers.length;i++)t.extend(markers[i].getPosition());googleMap.fitBounds(t),$("#overmap .icons li.calendar").fadeIn(),$("#overmap .icons li.force-position").fadeIn(),$("#overmap .icons li.virtual-fences").fadeIn(),resizeSidebar()}function loadUserMessages(e){if(e)var t="/notification-messages/simplified?real_time_before="+e;else var t="/notification-messages/simplified";$(".message-box").append("<div class='message-loading'>"+tr("Loading")+"...</div>"),loading_message=!0,$.ajax({type:"GET",dataType:"json",crossDomain:!0,url:api_url+t,data:"&api_key=$$key&limit_rows=10".render({key:api_key}),success:function(e,t,i){loading_message=!1,$(".message-box .message-loading").fadeOut("slow",function(e){$(".message-box .message-loading").remove()}),200==i.status&&($.each(e.notifications,function(e,t){var i=t.real_time.split(".");i=i[0],i=i.replace(" ","T");var a="item",s="";if(0==t.read)var a="item unread",s=" title='"+tr("Click to mark as read")+"'";var n="<div class='"+a+"' ref='"+i+"' ref-id='"+t.id+"' "+s+">";n+="<p class='title'>"+t.title+"</p>",n+="<p class='time'>"+convertDate(t.display_time)+"</p>",n+="</div>",$(".message-box .message-list").append(n)}),$(".message-box .message-list .item").length<=0&&e.notifications.length<=0&&$(".message-box .message-list").html("<div class='empty'>"+tr("No messages found")+"</div>")),updateMessageCounter(),$(".message-box .message-list .unread").unbind(),$(".message-box .message-list .unread").bind("click",function(){loading_message||markMessageAsRead(this)})},error:function(e){loading_message=!1,$(".message-box .message-loading").fadeOut("slow",function(e){$(".message-box .message-loading").remove()}),$(".message-box .message-list").html("<div class='empty'>"+tr("No messages found")+"</div>")}}),$(".message-box .message-list").on("scroll",function(){$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&(loading_message||loadUserMessages($(".message-box .message-list .item:last-child").attr("ref")))})}function updateMessageCounter(){$(".user-messages .counter").html($(".message-box .message-list .unread").length),$(".user-messages").attr("title",tr("You have")+" "+$(".message-box .message-list .unread").length+" "+tr("unread messages"))}function markMessageAsRead(e){var t=$(e).attr("ref-id"),i="/notification-messages/"+t;loading_message=!0,$.ajax({type:"DELETE",dataType:"json",crossDomain:!0,url:api_url+i,data:"&api_key=$$key".render({key:api_key}),success:function(t,i,a){loading_message=!1,$(e).removeClass("unread"),updateMessageCounter()},error:function(e){loading_message=!1}})}function mountTabs(e){if(e){var t=$(".user-history .tabs li.item:visible");$(t).each(function(i,a){if($(a).attr("m-index")==e)if(i<2){if(parseInt($(t[0]).attr("m-index"))>0){var s=parseInt($(t[0]).attr("m-index"))-1,n=parseInt($(t[4]).attr("m-index"));$(".user-history .tabs li[m-index="+n+"]").fadeOut("fast",function(){$(".user-history .tabs li[m-index="+s+"]").fadeIn("fast")})}}else if(i>2&&parseInt($(t[4]).attr("m-index"))<$(".user-history .tabs li.item").length-1){var s=parseInt($(t[4]).attr("m-index"))+1,n=parseInt($(t[0]).attr("m-index"));$(".user-history .tabs li[m-index="+n+"]").fadeOut("fast",function(){$(".user-history .tabs li[m-index="+s+"]").fadeIn("fast")})}})}else{e=parseInt($(".user-history .tabs li.active").attr("m-index")),$(".user-history .tabs li.item").hide();var a=e-2,s=e+2;for(e<=1?(a=0,s=4):e>=$(".user-history .tabs li.item").length-2&&(a=$(".user-history .tabs li.item").length-5,s=$(".user-history .tabs li.item").length-1),delayi=1,i=a;i<=s;i++)$(".user-history .tabs li[m-index="+i+"]").fadeIn(400*delayi),delayi++}}function convertDate(e,t){var i=new Date,a=-(i.getTimezoneOffset()/60);t||(t="dd/MM/yyyy HH:mm");var s=new Date(e),n=s.getHours();n+=a,s.setHours(n);var o=$.format.date(s,t);return o}function deleteAllMarkers(){$.each(markers,function(e,t){t.setMap(null)}),markers=[],markerClusterer&&markerClusterer.clearMarkers()}function pinSymbol(e){return{path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:e,fillOpacity:1,strokeColor:"#000",strokeWeight:0,scale:1}}function checkIfMobile(){return"<md"==bs_viewport}var modal=$("#myModal"),title=$("#myModal .modal-title"),avatar=$("#myModal .modal-body .avatar img"),description=$("#myModal .modal-body p"),button=$("#myModal .modal-footer .btn"),googleMap,markers=[],markerClusterer,popupIW=null,data_location,group_list,member_list,member_history,fences_list,group_id=null,member_id=null,members_alias=[],labels="ABCDEFGHIJKLMNOPQRSTUVWXYZ",calendarSet=!1,drawingManager,fencePolygon,loading_message=!1,bs_viewport;String.prototype.render||(String.prototype.render=function(e){var t=this+"";for(var i in e)t=t.replace(RegExp("\\$\\$"+i,"g"),e[i]);return t}),$.extend({getUrlVars:function(){for(var e,t=[],i=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),a=0;a<i.length;a++)e=i[a].split("="),t.push(e[0]),t[e[0]]=e[1];return t},getUrlVar:function(e){return $.getUrlVars()[e]},getUrlSub:function(){var e=location.hash,t=e.split("#!");if(t.length>1){var i=t[1].split("/");if(i.length>1)var a=i[1];else var a=t[1];var i=a.split("?");if(i.length>1)var a=i[0];else var a=i}else var a="";return a},getIdFromUrl:function(e){var t=e.split("/");return t.length>0?t[t.length-1]:null},scrollTo:function(e,t){$(e).animate({scrollTop:$(t).offset().top},"slow")}});var watchId=null;!function(e,t){e(document).ready(function(){t.is("xs")&&(bs_viewport="xs"),t.is(">=sm")&&(bs_viewport=">=sm"),t.is("<md")&&(bs_viewport="<md"),e(window).resize(t.changed(function(){t.is("xs")&&(bs_viewport="xs"),t.is(">=sm")&&(bs_viewport=">=sm"),t.is("<md")&&(bs_viewport="<md")}))})}(jQuery,ResponsiveBootstrapToolkit),$(document).ready(function(){$("html").click(function(e){$("#contextMenu").hide()}),validateCookie(function(){for(var e=document.querySelectorAll(".telephone"),t=document.querySelectorAll(".name"),i=document.querySelectorAll(".email"),a=document.querySelectorAll(".profile_picture_url"),s=0;s<=e.length-1;s++)e[s].innerHTML=user_data.telephone,t[s].innerHTML=user_data.name,i[s].innerHTML=user_data.email,a[s].innerHTML=user_data.profile_picture_url;$(".dashboard-content").show(),$(".preloader").fadeOut("fast")},__default_cookie_error),$(".user-config").click(function(){$(".message-box").hide(),$(".config-box").toggle()}),$(".user-messages").click(function(){$(".config-box").hide(),$(".message-box").toggle()}),$("#flash .close,#flash-modal .close,.flash-modal .close").click(function(){$(this).parent().fadeOut("slow")}),$("#overmap .icons li.calendar a").click(function(e){e.preventDefault(),$("#myModalCalendar").modal()}),$("#overmap .icons li.force-position a").click(function(e){e.preventDefault(),forcePosition()}),$("#overmap .icons li.virtual-fences a").click(function(e){e.preventDefault(),location.hash="#!/virtual-fences?g="+$.getUrlVar("g")+"&u="+$.getUrlVar("u")}),$("#myModalCalendar button#save").click(function(e){calendarSet=!0,deleteAllMarkers(),loadMemberPositions(loadMemberMarkers),$("#myModalCalendar").modal("hide")}),$(".icon-bottom-bar img").click(function(e){$(".bottom__bar .contents").toggleClass("opened"),resizeSidebar()}),$(".buttons a p").each(function(e,t){$(t).html(tr($(t).html()))}),$(".config-box .buttons a").on("click",function(e){$(this).hasClass("logout")||e.preventDefault()}),resizeSidebar(),$("#datepicker").datepicker({maxDate:"0"}),$("#time-slider").slider({range:!0,min:1,max:23,values:[1,23],slide:function(e,t){$(".time-label .hour-ini").html(("0"+t.values[0]).slice(-2)+":00"),$(".time-label .hour-end").html(("0"+t.values[1]).slice(-2)+":59")}}),$(".icons ul li").each(function(e,t){$(this).find("a").attr("title",tr($(this).find("a").attr("title"))),$(this).find("a").attr("alt",tr($(this).find("a").attr("title")))}),loadUserMessages()}),window.addEventListener?window.addEventListener("load",resizeSidebar,!1):window.attachEvent("onload",resizeSidebar),window.addEventListener("orientationchange",resizeSidebar,!1),window.addEventListener("resize",resizeSidebar,!1);var load_map=setTimeout(getTrack(),2e3);$(window).hashchange(function(){$("#overmap .icons li").hide(),""==$.getUrlSub()?(deleteAllMarkers(),initialize(loadGroupPositions,loadGroupMarkers)):"group"==$.getUrlSub()?(deleteAllMarkers(),group_id?loadGroupMembers():initialize(loadGroupMembers,null)):"member"==$.getUrlSub()?(deleteAllMarkers(),group_id?loadMemberPositions(loadMemberMarkers):initialize(loadMemberPositions,loadMemberMarkers)):"virtual-fences"==$.getUrlSub()?(deleteAllMarkers(),group_id?loadFencesMenu():initialize(loadGroupPositions,loadFencesMenu)):"virtual-fences-delete"==$.getUrlSub()&&deleteFence()}),$(window).hashchange();